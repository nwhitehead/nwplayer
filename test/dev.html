<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Nathan's HTML5 Video Player</title>
</head>

<body>

<!--
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
-->

<link type="text/css" href="jquery-ui-1.8.16.custom.css" rel="Stylesheet" />
<script src="jquery-1.7.1.min.js"></script>
<script src="jquery-ui-1.8.16.custom.min.js"></script>

<script>

//// Video helper functions

var is_playing = function(video) {
    // Return true or false depending on whether video is playing
    var paused = video.paused;
    return (paused === undefined) || (paused === false) || (paused === 'false');
};

var is_ready = function(video) {
    return video.readyState > 0;
};
    
$.fn.nwVideo = function(options) {
    console.log('Converting video player');
    // Build options data structures before iteration
    var defaults = {
        theme: 'simpledark',
        childtheme: ''
    };
    var options = $.extend(defaults, options);
    // Iterate for each player element
    return this.each(function () {
        var $player = $(this);
        // Create highest level div
        var $topdiv = $('<div></div>').addClass('nwplayer-player').addClass(options.theme).addClass(options.childtheme);
        // Controls div
        var $controls = $('<div class="nwplayer-controls">' +
'    <a class="nwplayer-play" title="Play/Pause" />' +
'    <div class="nwplayer-seek" />' +
'    <div class="nwplayer-timer">00:00</div>' +
'    <div class="nwplayer-volume-box">' +
'        <div class="nwplayer-volume-slider" />' +
'        <a class="nwplayer-volume-button" title="Mute/Unmute" />' +
'    </div>' +
'</div>');
        $player.wrap($topdiv);
        $player.after($controls);
        // Remove existing fallback controls, will be replaced
        $player.removeAttr('controls');

        // Get handles to all elements
        var $container = $player.parent('.nwplayer-player');
        var $controls = $('.nwplayer-controls', $container);
        var $play_button = $('.nwplayer-play', $container);
        var $seek = $('.nwplayer-seek', $container);
        // Hide our controls until done
        $controls.hide();
        // Play/Pause function
        var playpause_func = function() {
            if(is_playing($player[0])) {
                $player.attr('paused', true);
                $player[0].pause();
            } else {
                $player.attr('paused', false);
                $player[0].play();
            }
        };
        // Bind play/pause to button
        $play_button.click(playpause_func);
        // Also bind to clicking on video
        $player.click(playpause_func);
        $player.bind('play', function() {
            $play_button.addClass('nwplayer-pause');
        });
        $player.bind('pause', function() {
            $play_button.removeClass('nwplayer-pause');
        });
        $player.bind('ended', function() {
            $play_button.removeClass('nwplayer-pause');
        });
        // Position scrubber is a JQuery UI slider
        var createScrubber = function() {
            console.log('trying createScrubber()');
            // Wait until player is ready to create scrubber
            if(is_ready($player[0])) {
                var duration = $player.attr('duration');
                // Call jQuery UI to make the slider
                $seek.slider({
                    value: 0,
                    step: 0.01,
                    orientation: 'horizontal',
                    range: 'min',
                    max: duration,
                    animate: true,
                    slide: function() {
                        seeksliding = true;
                    },
                    stop: function() {
                        seeksliding = false;
                        $player.attr('currentTime', ui.value);
                    }
                });
            } else {
                // If not ready, try again in 150ms
                setTimeout(createScrubber, 150);
            }
        };
        createScrubber();
        // Unhide our magnificent controls
        $controls.show();
    });
};
</script>

<style>
div.demo { 
    background-color: #fffff0;
    padding: 10px !important;
}
</style>

<div class="demo">
<div id="testslider"></div>
</div>

<p>Below this text should be the working player.</p>

<video id="nwplayer" width="800" height="600" controls="controls">
    <source src="video/test.mp4" type="video/mp4" />
    <source src="video/test.webm" type="video/webm" />
</video>

<script>
$(function() {
    // Test the slider
    $('#testslider').slider();
    // Convert regular video tags into using nwplayer
    $('video').nwVideo();
});
</script>

</body>
</html>
